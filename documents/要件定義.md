# 目標ジャーナル・コーチ（ChatGPTアプリ）要件定義 v0.1

## 1. アプリ概要

### 1.1 目的
- ChatGPT 内のウィジェットで「日記」「やりたいこと」「週間タスクリスト」「行動分析」を一体で扱う。
- 人間が話した・入力したテキストを GPT が整理・タグ付け・分析・タスク登録し、日々と週間のふり返りを手助けする。

### 1.2 想定ユーザー
- 個人利用のユーザー（まずは開発者本人を想定）。
- 目標や行動をゆるく記録したい人。
- プログラミング知識は不要。ChatGPT の通常の会話に近い体験で使う。

### 1.3 利用シナリオ（例）
1. ユーザーがその日の出来事を音声／テキストで話す。
2. GPT がテキストを整理し、SQLite に保存する。
3. 同時に 2 つのタグを自動生成して日記カードに表示。
4. ユーザーはタグや文章を手で修正することができ、編集した場合は登録ボタンで上書き保存。
5. 週末に日記登録後、「行動分析」カードで期間を選択し、分析を開始する。
6. GPT が行動の傾向や気づきを文章で出力し、内容がよければ「登録」ボタンで保存。
7. 「やりたいこと」「週間タスクリスト」で、日々や週のタスクをチェックしながら進める。

---

## 2. 画面・カード構成

1 ページに以下 4 カードを縦並びで表示：

1. 今日の日記カード
2. 週間タスクリストカード（今週のタスク）
3. やりたいことカード
4. 行動分析カード（週／月単位の分析）

※ UI は React + Tailwind + `@openai/apps-sdk-ui` を想定。

---

## 3. 機能要件

### 3.1 今日の日記カード

**F-1 日付選択**
- 日付はデフォルトで「今日」を選択。
- ドロップダウンから過去日付も選べる。
- 日付を切り替えたら、その日の日記を DB から読み込んで表示。

**F-2 日記テキスト入力**
- テキストエリアにその日の出来事や気分を入力。
- 入力は ChatGPT のチャットから渡ってくるテキストを想定。
- 保存後は同じテキストをそのままカードに表示。

**F-3 自動タグ生成**
- 日記保存時、GPT が内容からタグ候補を最大5つ生成。
- タグは 0〜5 個までを保持し、0 個の場合もエラーとしない。
- タグは「〇〇」「△△」のような短い日本語テキスト。
- 生成されたタグは日記と一緒に DB に保存。

**F-4 タグ編集**
- タグはユーザーが手入力で修正できる。
- 1 つのタグを削除／書き換え可能。
- タグの編集は即座に DB に反映。

**F-5 日記の修正**
- 修正後のテキストを確認し、「反映」ボタンで日記本文を置き換え。
- 置き換え後の内容を再度 DB に保存。

---

### 3.2 週間タスクリストカード

**F-6 対象週の選択**
- 特に、対象週を選択しない。カードに記載されているものを週間タスクと理解して、ユーザーが使用する。

**F-7 週間タスクの登録**
- 「今週中にやりたいこと」を登録しておく場所として使う。

**F-8 タスク一覧表示**
- 表示・操作は「やりたいことカード」とほぼ同じ UI。
- チェックボックス付きのタスクを縦にリスト表示。
- 各行に「タスク名」と「削除」ボタン。

---

### 3.3 やりたいことカード

**F-9 タスク一覧表示**
- チェックボックス付きのタスクを縦にリスト表示。
- 各行に「タスク名」と「削除」ボタン。

**F-10 タスク追加**
- 空行または入力欄にテキストを入力して「＋」ボタンで追加。
- 追加されたタスクは SQLite に保存。

**F-11 タスク完了／削除**
- チェックを付けたタスクは「完了状態」として保存。
- 「削除」ボタンでタスクをリストと DB から削除。

---

### 3.4 行動分析カード

**F-12 期間選択（週／月）**
- トグルスイッチで「週」「月」を選択。
- 「開始日」はカレンダー UI から選ぶ。
- 週の場合：開始日から 7 日分のログを対象。
- 月の場合：開始日の月の月末までが対象。

**F-13 分析実行（GPT）**
- 選択された期間の日記・タスク・タスク完了状況をまとめて GPT に渡す。
- GPT が分析を行いテキストを生成する。このアプリとして分析方法は固定せず、ユーザーがチャット上で GPT にどのように分析するかを指示する想定。
- 生成結果をカード内のテキストエリアに表示。

**F-14 分析結果の登録**
- 内容がよければ「登録」ボタンを押すと、分析結果を SQLite に保存。
- 保存された分析は後から再利用できるようにする（例：別画面で一覧表示する仕様は後日検討）。

**F-15 分析履歴一覧の表示**
- 行動分析カードの下部に、過去の分析結果を一覧表示する。
- 一覧には直近5件を表示し、各行に以下を表示する。
  - 期間種別（週／月）
  - 期間（開始日〜終了日）
  - 登録日時
- 一覧の下に「もっと見る」リンクを配置し、将来的に全履歴一覧画面へ遷移できるようにしておく（初期実装ではリンクのみでもよい）。
- 一覧の行をクリックすると、その分析テキストを下に配置されたエリアに全文表示する。

---

### 3.5 共通機能

**F-16 データ保存**
- 日記、タグ、タスク、週間タスク、分析結果はすべて SQLite のローカル DB に保存。
- セッションが終わってもデータは保持される。

**F-17 GPT 連携**
- ChatGPT Apps SDK の server サイドからモデルを呼び出し、
  - タグ生成
  - 行動分析
  を行う。
- モデル呼び出しは、ユーザー操作（ボタン）またはチャットの指示に応じて実行。

**F-18 エラーハンドリング（簡易）**
- DB 書き込みエラーや GPT 呼び出しエラーが発生した場合、
  - 画面上に「保存に失敗しました」「分析に失敗しました」などのメッセージを表示。
  - 再試行ボタンを用意する。

---

## 4. データ構造（案）

### 4.1 日記テーブル `diaries`
- `id` : 主キー
- `date` : 日付（YYYY-MM-DD）
- `content` : 日記本文テキスト
- `tag1` : タグ 1 テキスト
- `tag2` : タグ 2 テキスト
- `tag3` : タグ 3 テキスト
- `tag4` : タグ 4 テキスト
- `tag5` : タグ 5 テキスト
- `created_at` : 作成日時
- `updated_at` : 更新日時

### 4.2 やりたいことテーブル `todos`
- `id`
- `title` : タスク名
- `is_done` : 完了フラグ
- `created_at`
- `updated_at`

### 4.3 週間タスクリストテーブル `weekly_tasks`
- `id`
- `week_start_date` : 週の開始日
- `title` : タスク名
- `is_done` : 完了フラグ
- `created_at`
- `updated_at`

### 4.4 行動分析テーブル `analyses`
- `id`
- `period_type` : "week" or "month"
- `start_date` : 期間開始日
- `end_date` : 期間終了日（アプリ側で計算）
- `summary` : 分析結果テキスト
- `created_at`

---

## 5. 非機能要件（初期）

1. **プラットフォーム**
   - ChatGPT Apps SDK を利用。
   - フロント：React + Tailwind + `@openai/apps-sdk-ui`。
   - サーバ：Node.js（Apps SDK 標準構成）＋ SQLite。
   - 参照URL
    https://github.com/openai/openai-apps-sdk-examples
    https://github.com/openai/apps-sdk-ui/
    https://developers.openai.com/apps-sdk/quickstart
    https://mcpcat.io/guides/openai-apps-sdk-quickstart-typescript/

2. **認証・利用範囲**
   - 初期はプレビュー用途のみ。
   - ChatGPT のログインユーザー = アプリのユーザーとみなし、追加の認証は行わない。

3. **性能・スケール**
   - 単一ユーザー、日記数は数千件程度を想定。
   - レスポンスは数秒以内（GPT 呼び出し時間を除く）。

4. **可用性・バックアップ**
   - SQLite ファイルのバックアップはなし（プレビュー段階のため）。

5. **ログ・監視**
   - 詳細な監視は行わない（プレビュー段階のため）。

6. **セキュリティ**
   - 外部公開しない前提（ローカル or 限定環境）。
   - 将来の外部公開時には認証と暗号化の追加を検討。

---

## 6. 今後検討する項目（未確定）

- 日記・タスク・分析結果のエクスポート方法（例：Markdown/CSV）。
- ユーザー認証。
